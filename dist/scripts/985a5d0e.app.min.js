"use strict";var myApp=angular.module("RostRecept",["ngAnimate","ngRoute"]).constant("version","v0.1.0").config(["$locationProvider","$routeProvider",function(a,b){a.html5Mode(!1),b.when("/",{templateUrl:"views/home.html"}).otherwise({redirectTo:"/"})}]);myApp.config(["$httpProvider",function(a){a.defaults.useXDomain=!0}]),angular.module("RostRecept").controller("MainCtrl",["$scope","$location","version",function(a,b,c){a.$path=b.path.bind(b),a.version=c}]),angular.module("RostRecept").controller("voteCtrl",["$scope","voteService","votingresultService",function(a,b,c){function d(a){var d=a.voteringid;return b.fetchVoteResult(a.votering_url_xml).then(function(a){c.addGovermentVote(d,a)}),a}function e(b){return a.next.vote=b,b}function f(a){return a}function g(){return void 0!=a.next.vote&&(a.vote=a.next.vote),b.fetchVote().then(e).then(d).then(f)}function h(b){var d=a.vote.voteringid;c.addUserVote({id:d,result:b}),a.voteringinformation=c.resultOfVote(d),g()}a.next={},b.init().then(function(){g().then(g)}),a.agreeWithVote=function(){h("Ja")},a.disagreeWithVote=function(){h("Nej")}}]);var riksdagensapi=angular.module("RostRecept");riksdagensapi.factory("voteService",["$http","$q",function(a,b){function c(b){return a.jsonp(j+"dokumentlista/?rm="+b.rm+"&bet="+b.bet+"&utformat=jsonp&callback=JSON_CALLBACK").then(function(a){return a.data.dokumentlista.dokument})}function d(c,d){var e=b.defer(),f=c.dokumentstatus_url_xml.replace(".xml",".jsonp?callback=JSON_CALLBACK"),h=f.replace("dokumentstatus","utskottsforslag");return a.jsonp(h).success(function(a){var b=a.utskottsforslag.dokutskottsforslag.utskottsforslag;if(Array.isArray(b)){var b=b.filter(function(a){return a.punkt==d.punkt});e.resolve(b[0])}else e.resolve(b)}),g=function(a){var b=a.utskottsforslag.dokutskottsforslag.utskottsforslag.filter(function(a){return a.punkt==d.punkt});e.resolve(b[0])},e.promise}function e(a){var b=a.forslag.match(/201\d\/\d\d:\S*/g,"");a.cleanCodes=[],b.forEach(function(b){b=b.match(/[A-Za-z]/)?b.replace(":","02"):b.replace(":","03"),b=b.replace(/2011\/12/g,"GZ"),b=b.replace(/2012\/13/g,"H0"),b=b.replace(/2013\/14/g,"H1"),a.cleanCodes.push(j+"dokument/"+b)}),a.cleanforslag=a.forslag.replace(/av [^\)]*\)\s?/g,"").replace(/\s,\s/g,", ")}function f(b,c){return a.jsonp("http://data.riksdagen.se/voteringlista/?rm="+b+"&sz=5&utformat=jsonp&gruppering=bet&callback=JSON_CALLBACK").success(function(a){return a.voteringlista.votering.forEach(function(a){c.votering.push(a)}),a.voteringlista})}var g,h,i=[],j="http://data.riksdagen.se/";return window.rdjsonp=function(a){void 0!=a.votering&&h(a),void 0!=a.utskottsforslag&&g(a)},{years:["2013%2F14"],votering:i,init:function(){var a=[],c=this;return this.years.forEach(function(b){var d=f(b,c);a.push(d)}),b.all(a)},fetchVote:function(){var a=i.splice(Math.floor(Math.random()*this.votering.length),1)[0];return c(a).then(function(b){return d(b,a)}).then(function(b){return e(b),{summary:b.rubrik,forslag:b.cleanforslag,forslagurl:b.cleanCodes,voteringid:b.votering_id,votering_url_xml:b.votering_url_xml,orginalvotering:a.forslagspunkt}})},fetchVoteResult:function(c){var d=b.defer(),e=c+".jsonp";return a.jsonp(e).success(function(a){var b=a.votering.dokvotering.votering;b.forEach(function(a){a.randomNumber=Math.random()}),d.resolve(b)}),h=function(a){var b=a.votering.dokvotering.votering;b.forEach(function(a){a.randomNumber=Math.random()}),d.resolve(b)},d.promise},fetchTextForMotion:function(b){return a.get(b).success(function(a){return a.data})}}}]),angular.module("RostRecept").factory("votingresultService",[function(){var a={},b={};return{userVotes:a,govermentVotes:b,addUserVote:function(b){a[b.id]=b},addGovermentVote:function(a,c){b[a]=c},resultOfVote:function(c){var d=a[c],e=b[c];if(null!=e){var f=e.filter(function(a){return a.rost==d.result?!0:void 0});return f}}}}]);